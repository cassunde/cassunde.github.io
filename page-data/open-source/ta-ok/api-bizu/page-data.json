{"componentChunkName":"component---src-templates-index-js","path":"/open-source/ta-ok/api-bizu","result":{"data":{"site":{"meta":{"title":"Cassunde","description":"Cassunde profile and Blog","url":"https://cassunde.github.io","author":"cassunde","twitter":"@MattheusCassund","adsense":""}},"post":{"id":"4f895206-91e5-5feb-b01f-b464a7554f2a","html":"<h2>Publicando API-BIZU no Heroku</h2>\n<p>Hoje vou anotar como publiquei uma aplicação quarkus no heroku, nesse exemplo vou\ngerar uma imagem com a aplicação dentro e publica-la.</p>\n<!--more-->\n<p><strong>Heroku</strong></p>\n<p>Devemos criar uma conta heroku e instalar a CLI segindo esse tutorial:</p>\n<p><a href=\"https://devcenter.heroku.com/articles/heroku-cli\">https://devcenter.heroku.com/articles/heroku-cli</a></p>\n<p><strong>Criando imagem da Aplicação</strong></p>\n<p>Quando criamos um projeto quarkus vem com uma pasta chamada <code class=\"language-text\">docker</code> dentro de <code class=\"language-text\">src/main/</code>nessa pasta existe alguns Dokerfiles vamos usar o <code class=\"language-text\">Dockerfile.jvm</code> pois, usaremos o *-runner.jar para iniciar a aplicação.</p>\n<p>Para publicar uma imagem no heroku precisamo disponibilizar uma variável <code class=\"language-text\">--env PORT=</code> para que o Heroku possa fazer as rotas de rede até chegar na aplicação.</p>\n<p>Para disponibilizar essa porta vamos alterar o <code class=\"language-text\">Dockerfile.jvm</code> para como no exemplo abaixo:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM registry.access.redhat.com/ubi8/ubi-minimal:8.1\n\nARG JAVA_PACKAGE=java-1.8.0-openjdk-headless\nARG RUN_JAVA_VERSION=1.3.5\n\nENV LANG=&#39;en_US.UTF-8&#39; LANGUAGE=&#39;en_US:en&#39;\n\n# Install java and the run-java script\n# Also set up permissions for user `1001`\nRUN microdnf install openssl curl ca-certificates ${JAVA_PACKAGE} \\\n    &amp;&amp; microdnf update \\\n    &amp;&amp; microdnf clean all \\\n    &amp;&amp; mkdir /deployments \\\n    &amp;&amp; chown 1001 /deployments \\\n    &amp;&amp; chmod &quot;g+rwX&quot; /deployments \\\n    &amp;&amp; chown 1001:root /deployments \\\n    &amp;&amp; curl https://repo1.maven.org/maven2/io/fabric8/run-java-sh/${RUN_JAVA_VERSION}/run-java-sh-${RUN_JAVA_VERSION}-sh.sh -o /deployments/run-java.sh \\\n    &amp;&amp; chown 1001 /deployments/run-java.sh \\\n    &amp;&amp; chmod 540 /deployments/run-java.sh \\\n    &amp;&amp; echo &quot;securerandom.source=file:/dev/urandom&quot; &gt;&gt; /etc/alternatives/jre/lib/security/java.security\n\n# Configure the JAVA_OPTIONS, you can add -XshowSettings:vm to also display the heap size.\nENV JAVA_OPTIONS=&quot;-Dquarkus.http.host=0.0.0.0 -Djava.util.logging.manager=org.jboss.logmanager.LogManager&quot;\n\nCOPY target/lib/* /deployments/lib/\nCOPY target/*-runner.jar /deployments/app.jar\n\nUSER 1001\n\nCMD [&quot;java&quot;, &quot;-Dquarkus.http.port=${PORT}&quot;, &quot;-Dquarkus.http.host=0.0.0.0&quot;, &quot;-jar&quot;, &quot;/deployments/app.jar&quot;]</code></pre></div>\n<p>Beleza, feito essas alteração vamos efetivamente criar a imagem, com o terminal na pasta raiz do projeto execute os seguintes comando:</p>\n<ul>\n<li>Empacote aplicação</li>\n</ul>\n<blockquote>\n<p>./mvnw package</p>\n</blockquote>\n<ul>\n<li>Build da imagem</li>\n</ul>\n<blockquote>\n<p>$ docker build -f src/main/docker/Dockerfile.jvm -t taok/api-bizu .</p>\n</blockquote>\n<ul>\n<li>Testando para ver se a porta está alterando quando criamos um container</li>\n</ul>\n<blockquote>\n<p>$ docker run -i —rm —name api-bizu —env PORT=8081 -p 8081:8081 taok/api-bizu</p>\n</blockquote>\n<ul>\n<li>Acessando heroku</li>\n</ul>\n<blockquote>\n<p>$ heroku login</p>\n</blockquote>\n<ul>\n<li>Criando app</li>\n</ul>\n<blockquote>\n<p>$ heroku create api-bizu</p>\n</blockquote>\n<ul>\n<li>Logando no Register do Heroku, para funcionar direito seu usuário deve ter permissão para adiministrar o docker.</li>\n</ul>\n<blockquote>\n<p>$ heroku container:login</p>\n</blockquote>\n<ul>\n<li>Registrando e subindo imagem</li>\n</ul>\n<blockquote>\n<p>$ docker tag taok/api-bizu registry.heroku.com/api-bizu/web</p>\n<p>$ docker push registry.heroku.com/api-bizu/web</p>\n</blockquote>\n<ul>\n<li>Publicando imagem</li>\n</ul>\n<blockquote>\n<p>$ heroku container:release web -a api-bizu</p>\n</blockquote>\n<ul>\n<li>Logando aplicação</li>\n</ul>\n<blockquote>\n<p>$ heroku logs —tail</p>\n</blockquote>\n<ul>\n<li>Para testar se a aplicação está de fato sendo executada</li>\n</ul>\n<blockquote>\n<p>$ curl <a href=\"https://api-bizu.herokuapp.com/coleta/candidaturas\">https://api-bizu.herokuapp.com/coleta/candidaturas</a></p>\n</blockquote>\n<p>Esses foram os passos que fiz para publicar uma imagem quarkus na Plataforma do Heroku</p>","frontmatter":{"layout":"post","title":"Publicando API-BIZU no Heroku","path":"/open-source/ta-ok/api-bizu","category":"Java","tags":["Arquitetura","Quarkus","OpenSource"],"description":"","date":"2020/04/23","image":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABkUlEQVQY02PIT56VnTgtM2FKevzk1NiJOUnTC1Pn5CfNKsucl3nsk++F/0Fn/wWc+w9CZ/8HnvsfeB6BGApSZucmzUiLm5gaOyEpui8xugdoVl7K3LKkGfkb7vpc/h949l/QBZDSkEsgEmoQGIE0A1F24nSgzoTonpjwzsiwtty0mUWxU8vmnQ64+T/o3D+zTS/VFt232vHB49gvoEHomgtTZmcmTI0J70hN7C/Kn1laPLsie35F+cqck18s93xm6bzM0ntLYNpd483vfU//g9sP1QxERalzgI5PSeid2Lu+v29dRdGC4oQZZftfmu77Ybfiifzil+qr35hu/WS16wtcP0IzGM3JTJxcWT63uWlpY/XysrS5mfvf+F7673/0u/HGdyZbP5nv+Gy166vDge9+Z/5hap4NDOqaosXluQsK0ueWxk8tWn7V7xownP+5Hf0F1Gm9+6vdvu+OB74Duf5n/6FrBqK8pFnAqCoARljMlIrJh0Kv/vc/8y/o/H+P47/tgToP/nA98tv92G/vU38Bx0gUlSxCS/kAAAAASUVORK5CYII=","aspectRatio":2.5,"src":"/static/0aaab77da35a432f23915d15479a2197/46604/heroku_docker.png","srcSet":"/static/0aaab77da35a432f23915d15479a2197/62d80/heroku_docker.png 125w,\n/static/0aaab77da35a432f23915d15479a2197/e1953/heroku_docker.png 250w,\n/static/0aaab77da35a432f23915d15479a2197/46604/heroku_docker.png 500w,\n/static/0aaab77da35a432f23915d15479a2197/d8815/heroku_docker.png 750w,\n/static/0aaab77da35a432f23915d15479a2197/31987/heroku_docker.png 1000w,\n/static/0aaab77da35a432f23915d15479a2197/eeb1b/heroku_docker.png 1920w","sizes":"(max-width: 500px) 100vw, 500px"}}}}}},"pageContext":{}}}